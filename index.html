<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–µ—ñ–Ω—Ç –û–Ω–ª–∞–π–Ω</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            margin: 0;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            gap: 15px;
        }

        h1 {
            color: #0366d6;
            margin: 0;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 10px 15px;
            background-color: #fff;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 900px;
            box-sizing: border-box;
        }

        .controls label {
            font-weight: bold;
        }

        /* –¶–µ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –±—É–¥–µ–º–æ —Ö–æ–≤–∞—Ç–∏/–ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ */
        #color-picker-wrapper {
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .controls input[type="color"] {
            width: 40px;
            height: 40px;
            border: none;
            cursor: pointer;
            background: none;
            padding: 0;
        }

        .controls button {
            padding: 10px 15px;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
            color: #333;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s, border-color 0.3s;
        }

        .controls button.active {
            background-color: #0366d6;
            color: white;
            border-color: #0366d6;
        }

        .clear-button { background-color: #ff4757; color: white; border-color: #ff4757; }
        .save-button { background-color: #28a745; color: white; border-color: #28a745; }
        .clear-button:hover { background-color: #e04050; }
        .save-button:hover { background-color: #218838; }

        #paintCanvas {
            border: 2px solid #ccc;
            background-color: #fff;
            cursor: crosshair;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            touch-action: none;
            max-width: 100%;
        }
    </style>
</head>
<body>

    <h1>üé® –ü–µ—ñ–Ω—Ç –û–Ω–ª–∞–π–Ω</h1>

    <div class="controls">
        <button id="brushButton" class="active">üñåÔ∏è –ü–µ–Ω–∑–ª–∏–∫</button>
        <button id="undoButton">‚Ü©Ô∏è –í—ñ–¥–º—ñ–Ω–∏—Ç–∏</button>
        <hr style="width:1px;height:24px;background:#ccc;border:none;margin:0 5px;">

        <span id="color-picker-wrapper">
            <label for="colorPicker">–ö–æ–ª—ñ—Ä:</label>
            <input type="color" id="colorPicker" value="#000000">
        </span>

        <label for="brushSize">–†–æ–∑–º—ñ—Ä:</label>
        <input type="range" id="brushSize" min="1" max="50" value="5">
        <span id="brushSizeValue">5</span>
        <hr style="width:1px;height:24px;background:#ccc;border:none;margin:0 5px;">

        <button id="eraserButton">üßΩ –ì—É–º–∫–∞</button>
        <button id="clearButton" class="clear-button">–û—á–∏—Å—Ç–∏—Ç–∏</button>
        <button id="saveButton" class="save-button">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
    </div>

    <canvas id="paintCanvas"></canvas>

    <script>
        const canvas = document.getElementById('paintCanvas');
        const ctx = canvas.getContext('2d');

        const colorPickerWrapper = document.getElementById('color-picker-wrapper');
        const colorPicker = document.getElementById('colorPicker');
        const brushSizeInput = document.getElementById('brushSize');
        const brushSizeValue = document.getElementById('brushSizeValue');
        const brushButton = document.getElementById('brushButton');
        const eraserButton = document.getElementById('eraserButton');
        const clearButton = document.getElementById('clearButton');
        const saveButton = document.getElementById('saveButton');
        const undoButton = document.getElementById('undoButton');

        let painting = false;
        let isErasing = false;
        let brushColor = '#000000';
        let brushWidth = 5;
        let history = [];

        // --- –ù–û–í–Ü –¢–ê –û–ù–û–í–õ–ï–ù–Ü –§–£–ù–ö–¶–Ü–á ---

        function updateEraserCursor() {
            // –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–º—ñ—Ä –∫—É—Ä—Å–æ—Ä—É - 2px, —â–æ–± –π–æ–≥–æ –±—É–ª–æ –≤–∏–¥–Ω–æ
            const size = Math.max(brushWidth, 2);
            // –°—Ç–≤–æ—Ä—é—î–º–æ SVG-—Ä—è–¥–æ–∫ –∑ –¥–∏–Ω–∞–º—ñ—á–Ω–∏–º —Ä–æ–∑–º—ñ—Ä–æ–º
            const svg = `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 ${size} ${size}">
                            <circle cx="${size / 2}" cy="${size / 2}" r="${size / 2 - 1}" fill="none" stroke="black" stroke-width="1.5"/>
                       </svg>`;
            // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∫–∞—Å—Ç–æ–º–Ω–∏–π –∫—É—Ä—Å–æ—Ä –¥–ª—è –ø–æ–ª–æ—Ç–Ω–∞
            canvas.style.cursor = `url('data:image/svg+xml;utf8,${encodeURIComponent(svg)}') ${size / 2} ${size / 2}, auto`;
        }

        brushButton.addEventListener('click', () => {
            isErasing = false;
            brushButton.classList.add('active');
            eraserButton.classList.remove('active');
            canvas.style.cursor = 'crosshair'; // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –∫—É—Ä—Å–æ—Ä
            colorPickerWrapper.style.display = 'inline-flex'; // –ü–æ–∫–∞–∑—É—î–º–æ –ø–∞–ª—ñ—Ç—Ä—É
        });

        eraserButton.addEventListener('click', () => {
            isErasing = true;
            eraserButton.classList.add('active');
            brushButton.classList.remove('active');
            updateEraserCursor(); // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∫—É—Ä—Å–æ—Ä-–≥—É–º–∫—É
            colorPickerWrapper.style.display = 'none'; // –•–æ–≤–∞—î–º–æ –ø–∞–ª—ñ—Ç—Ä—É
        });

        brushSizeInput.addEventListener('input', (e) => {
            brushWidth = e.target.value;
            brushSizeValue.textContent = brushWidth;
            // –Ø–∫—â–æ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∞ –≥—É–º–∫–∞, –æ–Ω–æ–≤–ª—é—î–º–æ —Ä–æ–∑–º—ñ—Ä —ó—ó –∫—É—Ä—Å–æ—Ä—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
            if (isErasing) {
                updateEraserCursor();
            }
        });


        // --- –°–¢–ê–†–Ü –§–£–ù–ö–¶–Ü–á (–±–µ–∑ –∑–º—ñ–Ω) ---

        function fillCanvasBackground() {
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        function saveState() {
            if (history.length > 20) { history.shift(); }
            history.push(canvas.toDataURL());
        }

        function restoreState() {
            if (history.length > 1) {
                history.pop();
                const lastState = history[history.length - 1];
                const img = new Image();
                img.src = lastState;
                img.onload = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0);
                };
            } else if (history.length === 1) {
                 fillCanvasBackground();
            }
        }

        function resizeCanvas() {
            const currentDrawing = canvas.toDataURL();
            const controlsHeight = document.querySelector('.controls').offsetHeight;
            const availableHeight = window.innerHeight - controlsHeight - 80;

            canvas.width = document.body.clientWidth * 0.95;
            canvas.height = availableHeight;

            fillCanvasBackground();

            const img = new Image();
            img.src = currentDrawing;
            img.onload = () => { ctx.drawImage(img, 0, 0); };
        }

        function getEventCoordinates(event) {
            const rect = canvas.getBoundingClientRect();
            if (event.touches) {
                return { x: event.touches[0].clientX - rect.left, y: event.touches[0].clientY - rect.top };
            }
            return { x: event.clientX - rect.left, y: event.clientY - rect.top };
        }

        function startPosition(e) {
            e.preventDefault();
            painting = true;
            draw(e);
        }

        function endPosition() {
            if (painting) { saveState(); }
            painting = false;
            ctx.beginPath();
        }

        function draw(e) {
            if (!painting) return;
            e.preventDefault();

            const { x, y } = getEventCoordinates(e);

            ctx.strokeStyle = isErasing ? '#ffffff' : brushColor;

            ctx.lineWidth = brushWidth;
            ctx.lineCap = 'round';
            ctx.lineTo(x, y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x, y);
        }

        colorPicker.addEventListener('input', (e) => { brushColor = e.target.value; });

        clearButton.addEventListener('click', () => {
            fillCanvasBackground();
            saveState();
        });

        saveButton.addEventListener('click', () => {
            const link = document.createElement('a');
            link.download = `–º–∞–ª—é–Ω–æ–∫_${Date.now()}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
        });

        undoButton.addEventListener('click', restoreState);

        canvas.addEventListener('mousedown', startPosition);
        canvas.addEventListener('mouseup', endPosition);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseout', endPosition);

        canvas.addEventListener('touchstart', startPosition);
        canvas.addEventListener('touchend', endPosition);
        canvas.addEventListener('touchmove', draw);
        canvas.addEventListener('touchcancel', endPosition);

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        saveState();
    </script>
</body>
</html>
